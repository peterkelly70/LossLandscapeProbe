{% extends "base.html" %}

{% block page_title %}Report Viewer{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <!-- Reports List Sidebar -->
        <div class="col-md-3 col-lg-2">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Available Reports</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="{{ url_for('index') }}" class="list-group-item list-group-item-action">
                        <i class="bi bi-house-door me-2"></i>Dashboard
                    </a>
                    
                    <!-- CIFAR-10 Reports -->
                    <div class="list-group-item bg-light fw-bold">CIFAR-10</div>
                    
                    <!-- MultiSample -->
                    <div class="list-group-item ps-4 py-2 fw-semibold">MultiSample</div>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link active" data-src="/reports/cifar10/base/cifar10_base_test_report.html">
                        <i class="bi bi-file-earmark-text me-2"></i>Test Report
                    </a>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10/base/cifar10_base_training_report.html">
                        <i class="bi bi-journal-text me-2"></i>Training Report
                    </a>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10/base/cifar10_base_meta_report.html">
                        <i class="bi bi-graph-up me-2"></i>Meta-Model Report
                    </a>
                    <a class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10_multi/cifar10_multi.log" >
                        <i class="bi bi-terminal me-2"></i>Log
                    </a>
                    
                    <!-- 10% Sample Size -->
                    <div class="list-group-item ps-4 py-2 fw-semibold">10% Sample Size</div>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10/10pct/cifar10_10pct_test_report.html">
                        <i class="bi bi-file-earmark-text me-2"></i>Test Report
                    </a>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10/10pct/cifar10_10pct_training_report.html">
                        <i class="bi bi-journal-text me-2"></i>Training Report
                    </a>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10/10pct/cifar10_10pct_meta_report.html">
                        <i class="bi bi-graph-up me-2"></i>Meta-Model Report
                    </a>
                    <a class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10_10/cifar10_10.log" >
                        <i class="bi bi-terminal me-2"></i>Log
                    </a>
                    
                    
                    <!-- 20% Sample Size -->
                    <div class="list-group-item ps-4 py-2 fw-semibold">20% Sample Size</div>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10/20pct/cifar10_20pct_test_report.html">
                        <i class="bi bi-file-earmark-text me-2"></i>Test Report
                    </a>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10/20pct/cifar10_20pct_training_report.html">
                        <i class="bi bi-journal-text me-2"></i>Training Report
                    </a>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10/20pct/cifar10_20pct_meta_report.html">
                        <i class="bi bi-graph-up me-2"></i>Meta-Model Report
                    </a>
                    <a class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar10_20/cifar10_20.log" >
                        <i class="bi bi-terminal me-2"></i>Log
                    </a>
                    
                    
                    <!-- CIFAR-100 Reports -->
                    <div class="list-group-item bg-light fw-bold">CIFAR-100</div>
                    
                    <!-- MultiSample -->
                    <div class="list-group-item ps-4 py-2 fw-semibold">MultiSample</div>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar100/base/cifar100_base_test_report.html">
                        <i class="bi bi-file-earmark-text me-2"></i>Test Report
                    </a>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar100/base/cifar100_base_training_report.html">
                        <i class="bi bi-journal-text me-2"></i>Training Report
                    </a>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar100_multi/cifar100_multi.log">
                        <i class="bi bi-terminal me-2"></i>Log
                    </a>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar100/base/cifar100_base_meta_report.html">
                        <i class="bi bi-graph-up me-2"></i>Meta-Model Report
                    </a>
                    <a class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar100_multi/cifar100_multi.log">
                        <i class="bi bi-terminal me-2"></i>Log
                    </a>
                    
                    <!-- Transfer Learning -->
                    <div class="list-group-item ps-4 py-2 fw-semibold">Transfer Learning</div>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar100_transfer/cifar100_transfer.log">
                        <i class="bi bi-terminal me-2"></i>Log
                    </a>
                    <a href="#" class="list-group-item list-group-item-action ps-5 report-link" data-src="/reports/cifar100/transfer/cifar100_transfer_test_report.html">
                        <i class="bi bi-file-earmark-text me-2"></i>Test Report
                    </a>
                    <a href="/reports/cifar100_transfer/cifar100_transfer_results.pth" download>
                        <i class="bi bi-download me-2"></i>Download Results
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Report Viewer</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <a id="logs-btn" href="/logs" class="btn btn-sm btn-outline-secondary me-2" >
                            <i class="bi bi-terminal"></i> Logs
                        </a>
                        <a id="fullscreen-btn" href="#" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-arrows-fullscreen"></i> Fullscreen
                        </a>
                        <a id="download-btn" href="#" class="btn btn-sm btn-outline-secondary" download>
                            <i class="bi bi-download"></i> Download
                        </a>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-body p-0" style="min-height: 70vh;">
                    <iframe id="report-frame" 
                            src="/reports/cifar10/base/cifar10_base_test_report.html" 
                            style="width: 100%; height: 100%; min-height: 800px; border: none;"
                            onload="this.contentWindow.focus();"></iframe>
                </div>
            </div>
        </main>
    </div>
</div>

<style>
/* Custom styles for report viewer */
.list-group-item-action {
    transition: none !important;
}
.list-group-item-action:hover,
.list-group-item-action:focus {
    border-color: inherit;
    outline: none;
    background-color: rgba(13,110,253,0.15);
    transform: none !important;
}
.report-link.active {
    background-color: #0d6efd;
    color: white;
    border-color: #0d6efd;
}

#report-frame {
    width: 100%;
    height: 100%;
    min-height: 800px;
    border: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle report navigation
    const reportLinks = document.querySelectorAll('.report-link');
    const reportFrame = document.getElementById('report-frame');
    const downloadBtn = document.getElementById('download-btn');
    const logsBtn = document.getElementById('logs-btn');
    
    reportLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Update active state
            reportLinks.forEach(l => l.classList.remove('active'));
            this.classList.add('active');
            
            // Update iframe source
            const reportSrc = this.getAttribute('data-src');
            reportFrame.src = reportSrc;
            
            // Update download & logs buttons
            downloadBtn.href = reportSrc;
            downloadBtn.download = reportSrc.split('/').pop();

            // For log files, don't change anything
            if (reportSrc.endsWith('.log')) {
                logsBtn.href = reportSrc;
                return;
            }
            
            // For other reports, derive the log file path
            const m = reportSrc.match(/\/reports\/(cifar\d+)_(\w+)\//);
            if (m) {
                const [_, dataset, sampleSize] = m;
                logsBtn.href = `/reports/${dataset}_${sampleSize}/${dataset}_${sampleSize}.log`;
            }
        });
    });
    
    // Handle fullscreen
    document.getElementById('fullscreen-btn').addEventListener('click', function(e) {
        e.preventDefault();
        if (reportFrame.requestFullscreen) {
            reportFrame.requestFullscreen();
        } else if (reportFrame.webkitRequestFullscreen) {
            reportFrame.webkitRequestFullscreen();
        } else if (reportFrame.msRequestFullscreen) {
            reportFrame.msRequestFullscreen();
        }
    });
});
</script>
{% endblock %}
